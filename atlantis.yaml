version: 3
parallel_plan: true
parallel_apply: true
projects:
- name: develop
  dir: dev
  workspace: dev
  workflow: myworkflow
  apply_requirements: [mergeable, approved]
  autoplan:
    enabled: false
    when_modified: ["*.tf*", ".terraform.lock.hcl"]
- name: test
  dir: stage
  workspace: stage
  workflow: myworkflow
  apply_requirements: [mergeable]
  autoplan:
    enabled: true
    when_modified: ["*.tf*", ".terraform.lock.hcl"]
workflows:
  myworkflow:
    plan:
      steps:
      - init
      - plan:
          extra_args: ["-lock", "false"]
      - run: my-custom-command arg1 arg2
    apply:
      steps:
      - apply
